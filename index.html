<script>
  const drinks = [
    { name: "Dango", img: "placeholder.png" },
    { name: "NPC", img: "placeholder.png" },
    { name: "Sigma", img: "placeholder.png" },
    { name: "Alpha", img: "placeholder.png" },
    { name: "Jagung Susu", img: "placeholder.png" },
    { name: "StickyMilk Matcha", img: "placeholder.png" }
  ];

  const order = {
    customer: "",
    items: []
  };

  let selectedDrink = null;

  function loadDrinks() {
    const container = document.getElementById("drinkButtons");
    drinks.forEach((drink, index) => {
      const btn = document.createElement("div");
      btn.className = "drink-btn";
      btn.dataset.index = index;

      btn.onclick = () => selectDrink(index);

      btn.innerHTML = `
        <img src="${drink.img}" alt="${drink.name}">
        <div class="drink-name">${drink.name}</div>
      `;
      container.appendChild(btn);
    });
  }

  function selectDrink(index) {
    selectedDrink = index;
    document.querySelectorAll('.drink-btn').forEach(btn => {
      btn.classList.remove('selected');
    });
    document.querySelector(`.drink-btn[data-index="${index}"]`).classList.add('selected');
  }

  function addToOrder() {
    if (selectedDrink === null) {
      alert("Please select a drink.");
      return;
    }

    const note = document.getElementById("drinkNote").value.trim();
    const drink = drinks[selectedDrink].name;

    order.items.push({ drink, note });
    updateOrderList();

    document.getElementById("clickSound").play();

    selectedDrink = null;
    document.getElementById("drinkNote").value = "";
    document.querySelectorAll('.drink-btn').forEach(btn => btn.classList.remove('selected'));
  }

  // ✅ Replaced submitOrder() with your fixed version:
  function submitOrder() {
    const customer = document.getElementById("customerName").value.trim();
    if (!customer) {
      alert("Please enter customer name.");
      return;
    }

    if (order.items.length === 0) {
      alert("Add at least one item before submitting.");
      return;
    }

    order.customer = customer;

    fetch("https://fascinated-volcano-thief.glitch.me/order", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(order)
    })
    .then(res => {
      if (!res.ok) throw new Error("Server responded with an error.");
      return res.json();
    })
    .then(data => {
      console.log(data);
      alert("✅ Order submitted for " + order.customer + "!");
      order.items = [];
      updateOrderList();
      document.getElementById("customerName").value = "";
    })
    .catch(err => {
      console.error(err);
      alert("⚠️ Failed to submit order. Please try again.");
    });
  }

  function updateOrderList() {
    const ul = document.getElementById("orderList");
    ul.innerHTML = "";

    order.items.forEach((item, index) => {
      const li = document.createElement("li");
      li.className = "order-item";
      li.innerHTML = `
        <div><strong>${item.drink}</strong> <em>(${item.note})</em></div>
        <button class="delete-btn" onclick="removeOrderItem(${index})">❌</button>
      `;
      ul.appendChild(li);

      setTimeout(() => {
        li.classList.add('fade-in');
      }, 100);
    });
  }

  function removeOrderItem(index) {
    order.items.splice(index, 1);
    updateOrderList();
  }

  loadDrinks();
</script>
