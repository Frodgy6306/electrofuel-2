<!-- ... [head section stays the same] ... -->
<body>
  <h2>âš¡ Electrofuel Kitchen View âš¡</h2>

  <div class="orders" id="ordersContainer">
    <h3>Pending Orders</h3>
    <label style="display:block; margin-bottom: 10px;">
      <input type="checkbox" id="disableTTS" />
      ğŸ”‡ Disable TTS
    </label>
    <p>Loading orders...</p>
  </div>

  <div class="summary">
    <h3>Sales Summary</h3>
    <ul id="salesSummary"></ul>
    <button class="clear-summary-btn" onclick="clearSalesSummary()">ğŸ§¹ Clear Summary</button>
  </div>

  <script>
    const ordersContainer = document.getElementById("ordersContainer");
    const salesSummaryEl = document.getElementById("salesSummary");
    const disableTTS = document.getElementById("disableTTS");
    const salesSummary = {};

    async function fetchOrders() {
      try {
        const res = await fetch('https://fascinated-volcano-thief.glitch.me/order');
        const data = await res.json();
        renderOrders(data);
      } catch (err) {
        ordersContainer.innerHTML = "<p>âš ï¸ Error fetching orders.</p>";
        console.error(err);
      }
    }

    function renderOrders(orders) {
      ordersContainer.innerHTML = `
        <h3>Pending Orders</h3>
        <label style="display:block; margin-bottom: 10px;">
          <input type="checkbox" id="disableTTS" ${disableTTS.checked ? "checked" : ""}/>
          ğŸ”‡ Disable TTS
        </label>
      `;

      // Re-bind after replacing the HTML
      document.getElementById("disableTTS").addEventListener("change", (e) => {
        disableTTS.checked = e.target.checked;
      });

      if (orders.length === 0) {
        ordersContainer.innerHTML += "<p>No pending orders.</p>";
        return;
      }

      orders.forEach((order, index) => {
        const div = document.createElement("div");
        div.className = "order";

        const itemsList = order.items.map(i => 
          `<li>ğŸ¹ <strong>${i.drink}</strong>${i.note ? ` â€“ <em>${i.note}</em>` : ""}</li>`
        ).join("");

        div.innerHTML = `
          <h3>${order.customer}</h3>
          <ul>${itemsList}</ul>
          <button class="btn finish-btn" onclick="finishOrder('${order.customer}', ${index})">âœ… Finish</button>
          <button class="btn delete-btn" onclick="deleteOrder('${order.customer}', ${index})">ğŸ—‘ Delete</button>
        `;

        ordersContainer.appendChild(div);
      });
    }

    async function finishOrder(customerName, index) {
      if (!confirm(`Finish order for ${customerName}?`)) return;

      const res = await fetch('https://fascinated-volcano-thief.glitch.me/order');
      const orders = await res.json();
      const order = orders[index];

      order.items.forEach(item => {
        if (!salesSummary[item.drink]) salesSummary[item.drink] = 0;
        salesSummary[item.drink]++;
      });

      renderSalesSummary();

      // ğŸ”Š TTS unless disabled
      let message = `Order for ${customerName} is ready. `;
      order.items.forEach(item => {
        message += `${item.drink}`;
        if (item.note) message += `. Note: ${item.note}`;
        message += `. `;
      });

      if (!disableTTS.checked) {
        speak(message);
      }

      await fetch(`https://fascinated-volcano-thief.glitch.me/order/${index}`, {
        method: 'DELETE'
      });

      fetchOrders();
    }

    async function deleteOrder(customerName, index) {
      if (!confirm(`Delete order for ${customerName}? This cannot be undone.`)) return;

      await fetch(`https://fascinated-volcano-thief.glitch.me/order/${index}`, {
        method: 'DELETE'
      });

      fetchOrders();
    }

    function renderSalesSummary() {
      salesSummaryEl.innerHTML = "";
      Object.entries(salesSummary).forEach(([drink, count]) => {
        const li = document.createElement("li");
        li.textContent = `${drink}: ${count}`;
        salesSummaryEl.appendChild(li);
      });
    }

    function clearSalesSummary() {
      if (!confirm("Clear sales summary? This cannot be undone.")) return;
      for (let key in salesSummary) {
        delete salesSummary[key];
      }
      renderSalesSummary();
    }

    function speak(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'en-US';
      utterance.rate = 1;
      speechSynthesis.speak(utterance);
    }

    fetchOrders();
    setInterval(fetchOrders, 3000); // Refresh every 3 seconds
  </script>
</body>
</html>
